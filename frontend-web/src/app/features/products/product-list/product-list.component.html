<!-- ================================= -->
<!-- CATALOGUE PAGE - PREMIUM E-COMMERCE -->
<!-- Inspired by Apple, Amazon, Best Buy -->
<!-- ================================= -->

<div class="catalogue-page">
    <!-- Immersive Hero Header -->
    <section class="catalogue-hero">
        <div class="hero-background">
            <div class="gradient-orb orb-1"></div>
            <div class="gradient-orb orb-2"></div>
        </div>
        <div class="hero-content container">
            <div class="hero-text">
                <span class="hero-eyebrow">
                    <mat-icon>auto_awesome</mat-icon>
                    Explore Our Collection
                </span>
                <h1 class="hero-title">Premium Auto Parts</h1>
                <p class="hero-subtitle">Discover {{ totalElements() }} high-quality parts for your vehicle</p>
            </div>
            <div class="hero-search">
                <div class="search-box">
                    <mat-icon>search</mat-icon>
                    <input type="text" placeholder="Search parts, brands, categories..." [ngModel]="searchQuery()"
                        (ngModelChange)="searchQuery.set($event)" (keyup.enter)="onSearch()">
                    <button class="search-btn" (click)="onSearch()">
                        <mat-icon>arrow_forward</mat-icon>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content Area -->
    <div class="catalogue-body container">
        <!-- Sidebar Filters -->
        <aside class="filters-sidebar">
            <div class="filters-card">
                <div class="filters-header">
                    <h3><mat-icon>filter_list</mat-icon> Filters</h3>
                    @if (hasFilters()) {
                    <button class="clear-btn" (click)="clearFilters()">Clear All</button>
                    }
                </div>

                <!-- Active Filter Tags -->
                @if (hasFilters()) {
                <div class="active-filters">
                    @if (searchQuery()) {
                    <span class="filter-tag" (click)="removeFilter('search')">
                        <mat-icon>search</mat-icon>
                        "{{ searchQuery() }}"
                        <mat-icon class="remove">close</mat-icon>
                    </span>
                    }
                    @if (selectedCategory()) {
                    <span class="filter-tag" (click)="removeFilter('category')">
                        <mat-icon>category</mat-icon>
                        {{ getCategoryName(selectedCategory()) }}
                        <mat-icon class="remove">close</mat-icon>
                    </span>
                    }
                    @if (selectedBrand()) {
                    <span class="filter-tag" (click)="removeFilter('brand')">
                        <mat-icon>verified</mat-icon>
                        {{ getBrandName(selectedBrand()) }}
                        <mat-icon class="remove">close</mat-icon>
                    </span>
                    }
                </div>
                }

                <!-- Filter Sections -->
                <div class="filter-section">
                    <h4>Category</h4>
                    <div class="filter-options">
                        <button class="option-btn" [class.active]="!selectedCategory()"
                            (click)="onCategoryChange(null)">
                            All Categories
                        </button>
                        @for (category of categories(); track category.id) {
                        <button class="option-btn" [class.active]="selectedCategory() === category.id"
                            (click)="onCategoryChange(category.id)">
                            {{ category.name }}
                        </button>
                        }
                    </div>
                </div>

                <div class="filter-section">
                    <h4>Brand</h4>
                    <div class="filter-options scrollable">
                        <button class="option-btn" [class.active]="!selectedBrand()" (click)="onBrandChange(null)">
                            All Brands
                        </button>
                        @for (brand of brands(); track brand.id) {
                        <button class="option-btn" [class.active]="selectedBrand() === brand.id"
                            (click)="onBrandChange(brand.id)">
                            {{ brand.name }}
                        </button>
                        }
                    </div>
                </div>

                <div class="filter-section">
                    <h4>Price Range</h4>
                    <div class="price-range-inputs">
                        <div class="price-input">
                            <span class="currency">TND</span>
                            <input type="number" placeholder="Min" [ngModel]="priceRange().min"
                                (ngModelChange)="updatePriceRange('min', $event)">
                        </div>
                        <span class="separator">—</span>
                        <div class="price-input">
                            <span class="currency">TND</span>
                            <input type="number" placeholder="Max" [ngModel]="priceRange().max"
                                (ngModelChange)="updatePriceRange('max', $event)">
                        </div>
                    </div>
                </div>

                <div class="filter-section toggle-section">
                    <div class="toggle-row">
                        <div class="toggle-label">
                            <mat-icon>inventory_2</mat-icon>
                            <span>In Stock Only</span>
                        </div>
                        <mat-slide-toggle [checked]="inStockOnly()" (change)="onInStockChange()"
                            color="primary"></mat-slide-toggle>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Products Section -->
        <main class="products-section">
            <!-- Toolbar -->
            <div class="products-toolbar">
                <div class="toolbar-left">
                    <span class="results-count">
                        <strong>{{ products().length }}</strong> products found
                    </span>
                </div>
                <div class="toolbar-right">
                    <div class="sort-control">
                        <span class="sort-label">Sort by</span>
                        <mat-select [value]="sortBy()" (valueChange)="onSortChange($event)" class="sort-select">
                            <mat-option value="newest">Newest First</mat-option>
                            <mat-option value="name">Name (A-Z)</mat-option>
                            <mat-option value="price_asc">Price: Low → High</mat-option>
                            <mat-option value="price_desc">Price: High → Low</mat-option>
                        </mat-select>
                    </div>
                    <div class="view-toggle">
                        <button [class.active]="viewMode() === 'grid'" (click)="viewMode.set('grid')"
                            matTooltip="Grid View">
                            <mat-icon>grid_view</mat-icon>
                        </button>
                        <button [class.active]="viewMode() === 'list'" (click)="viewMode.set('list')"
                            matTooltip="List View">
                            <mat-icon>view_list</mat-icon>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            @if (loading()) {
            <div class="products-grid">
                @for (i of [1,2,3,4,5,6,7,8]; track i) {
                <div class="skeleton-card">
                    <div class="skeleton-image"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-line brand"></div>
                        <div class="skeleton-line title"></div>
                        <div class="skeleton-line price"></div>
                    </div>
                </div>
                }
            </div>
            } @else {
            <!-- Products Grid -->
            @if (products().length > 0) {
            <div class="products-grid" [class.list-view]="viewMode() === 'list'">
                @for (product of products(); track product.id) {
                <article class="product-card">
                    <!-- Card Image -->
                    <div class="card-image" [routerLink]="['/products', product.id]">
                        <img [src]="product.imageUrl || 'assets/placeholder-part.png'" [alt]="product.name"
                            loading="lazy">

                        <!-- Badges -->
                        <div class="badges">
                            @if (product.discount) {
                            <span class="badge sale">-{{ product.discount }}%</span>
                            }
                            @if (product.stock <= 0) { <span class="badge out">Out of Stock</span>
                                }
                        </div>

                        <!-- Quick Actions -->
                        <div class="quick-actions">
                            <button class="action-btn cart" (click)="$event.stopPropagation(); addToCart(product)"
                                [disabled]="product.stock <= 0" matTooltip="Add to Cart">
                                <mat-icon>shopping_cart</mat-icon>
                            </button>
                            <button class="action-btn view" [routerLink]="['/products', product.id]"
                                matTooltip="Quick View">
                                <mat-icon>visibility</mat-icon>
                            </button>
                        </div>
                    </div>

                    <!-- Card Body -->
                    <div class="card-body">
                        <div class="card-meta">
                            <span class="brand">{{ product.brand?.name || 'Generic' }}</span>
                            <span class="stock-indicator" [class.in-stock]="product.stock > 0">
                                <span class="dot"></span>
                                {{ product.stock > 0 ? 'In Stock' : 'Out of Stock' }}
                            </span>
                        </div>

                        <h3 class="card-title" [routerLink]="['/products', product.id]">
                            {{ product.name }}
                        </h3>

                        <div class="card-footer">
                            <div class="price-block">
                                @if (product.discount) {
                                <span class="original-price">{{ product.price }} TND</span>
                                <span class="sale-price">
                                    {{ product.price * (1 - product.discount / 100) | number:'1.2-2' }} TND
                                </span>
                                } @else {
                                <span class="current-price">{{ product.price }} TND</span>
                                }
                            </div>
                            <button class="add-btn" (click)="addToCart(product)" [disabled]="product.stock <= 0">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                    </div>
                </article>
                }
            </div>

            <!-- Pagination -->
            <div class="pagination-wrapper">
                <mat-paginator [length]="totalElements()" [pageSize]="pageSize()" [pageIndex]="pageIndex()"
                    [pageSizeOptions]="[12, 24, 48]" (page)="onPageChange($event)" showFirstLastButtons>
                </mat-paginator>
            </div>
            } @else {
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-icon">
                    <mat-icon>inventory_2</mat-icon>
                </div>
                <h3>No Products Found</h3>
                <p>We couldn't find any products matching your criteria. Try adjusting your filters.</p>
                <button mat-flat-button color="primary" (click)="clearFilters()">
                    <mat-icon>refresh</mat-icon>
                    Reset Filters
                </button>
            </div>
            }
            }
        </main>
    </div>
</div>