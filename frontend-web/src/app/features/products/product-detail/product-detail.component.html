@if (loading()) {
<div class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <p>Chargement du produit...</p>
</div>
} @else if (product()) {
<div class="product-detail-wrapper" *ngIf="!loading() && product()">
    <!-- Hero Section -->
    <div class="product-hero">
        <div class="hero-bg"></div>
        <div class="container hero-content">
            <div class="product-visual">
                <div class="main-image-card">
                    <img [src]="product()!.imageUrl || 'assets/placeholder.png'" [alt]="product()!.name">
                    @if (hasDiscount()) {
                    <span class="hero-badge">-{{ product()!.discount }}% OFF</span>
                    }
                </div>
            </div>

            <div class="product-primary-info">
                <div class="brand-pill">{{ product()!.brand?.name || 'Premium Brand' }}</div>
                <h1 class="hero-title">{{ product()!.name }}</h1>

                <div class="rating-row" *ngIf="hasRating()">
                    <div class="stars">
                        @for (i of [1,2,3,4,5]; track i) {
                        <mat-icon>{{ i <= product()!.rating! ? 'star' : 'star_border' }}</mat-icon>
                                }
                    </div>
                    <span class="review-count">{{ product()!.reviewCount }} Verified Reviews</span>
                </div>

                <div class="price-block">
                    @if (hasDiscount()) {
                    <span class="old-price">{{ product()!.price }} TND</span>
                    <span class="current-price">{{ product()!.price * (1 - product()!.discount! / 100) | number:'1.2-2'
                        }} <small>TND</small></span>
                    } @else {
                    <span class="current-price">{{ product()!.price }} <small>TND</small></span>
                    }
                </div>

                <div class="hero-actions">
                    <div class="quantity-control glass-panel">
                        <button mat-icon-button (click)="decreaseQuantity()" [disabled]="quantity() <= 1">
                            <mat-icon>remove</mat-icon>
                        </button>
                        <span class="qty-val">{{ quantity() }}</span>
                        <button mat-icon-button (click)="increaseQuantity()"
                            [disabled]="quantity() >= product()!.stock">
                            <mat-icon>add</mat-icon>
                        </button>
                    </div>

                    <button mat-flat-button color="primary" class="action-btn buy-btn" (click)="addToCart()"
                        [disabled]="product()!.stock <= 0">
                        <mat-icon>shopping_bag</mat-icon>
                        Add to Cart
                    </button>
                </div>

                <p class="stock-status" [class.in-stock]="product()!.stock > 0">
                    <span class="dot"></span>
                    {{ product()!.stock > 0 ? 'In Stock & Ready to Ship' : 'Currently Out of Stock' }}
                </p>
            </div>
        </div>
    </div>

    <!-- Details Section -->
    <div class="container details-section">
        <mat-tab-group animationDuration="0ms" class="premium-tabs">
            <mat-tab label="Overview">
                <div class="tab-pane">
                    <p class="description-text">{{ product()!.description }}</p>

                    <div class="specs-grid">
                        <div class="spec-card">
                            <mat-icon>fingerprint</mat-icon>
                            <span>SKU: {{ product()!.sku }}</span>
                        </div>
                        <div class="spec-card">
                            <mat-icon>category</mat-icon>
                            <span>Category: {{ product()!.category?.name }}</span>
                        </div>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Specifications" *ngIf="hasSpecifications()">
                <div class="tab-pane">
                    <div class="glass-table">
                        @for (spec of product()!.specifications!; track spec.key) {
                        <div class="table-row">
                            <span class="key">{{ spec.key }}</span>
                            <span class="val">{{ spec.value }}</span>
                        </div>
                        }
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Compatibility" *ngIf="hasCompatibility()">
                <div class="tab-pane compatibility-pane">
                    <mat-icon class="car-icon">directions_car</mat-icon>
                    <h3>Vehicle Compatibility</h3>
                    <p>{{ product()!.compatibilityString }}</p>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>
}