<div class="reset-container">
    <div class="reset-card-wrapper">
        <mat-card class="reset-card">
            <mat-card-content>
                <div class="reset-header">
                    <div class="icon-wrapper">
                        <mat-icon class="reset-icon">vpn_key</mat-icon>
                    </div>
                    <h2 class="title">Reset Password</h2>
                    <p class="subtitle">
                        Enter the 6-digit verification code sent to <strong>{{ email }}</strong> and choose a new
                        password.
                    </p>
                </div>

                <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="reset-form">
                    <div class="code-input">
                        <mat-form-field appearance="outline">
                            <mat-label>Verification Code</mat-label>
                            <input matInput type="text" formControlName="code" placeholder="000000" maxlength="6"
                                class="code-field" autocomplete="off" />
                            <mat-icon matPrefix>verified_user</mat-icon>
                            @if (resetPasswordForm.get('code')?.invalid && resetPasswordForm.get('code')?.touched) {
                            <mat-error>{{ getCodeErrorMessage() }}</mat-error>
                            }
                        </mat-form-field>
                    </div>

                    <div class="password-input">
                        <mat-form-field appearance="outline">
                            <mat-label>New Password</mat-label>
                            <input matInput [type]="hidePassword() ? 'password' : 'text'" formControlName="newPassword"
                                placeholder="Enter new password" autocomplete="new-password" />
                            <mat-icon matPrefix>lock</mat-icon>
                            <button mat-icon-button matSuffix type="button" (click)="togglePasswordVisibility()"
                                [attr.aria-label]="'Hide password'">
                                <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
                            </button>
                            @if (resetPasswordForm.get('newPassword')?.invalid &&
                            resetPasswordForm.get('newPassword')?.touched) {
                            <mat-error>{{ getPasswordErrorMessage() }}</mat-error>
                            }
                        </mat-form-field>
                    </div>

                    <div class="confirm-password-input">
                        <mat-form-field appearance="outline">
                            <mat-label>Confirm New Password</mat-label>
                            <input matInput [type]="hideConfirmPassword() ? 'password' : 'text'"
                                formControlName="confirmPassword" placeholder="Confirm new password"
                                autocomplete="new-password" />
                            <mat-icon matPrefix>lock_outline</mat-icon>
                            <button mat-icon-button matSuffix type="button" (click)="toggleConfirmPasswordVisibility()"
                                [attr.aria-label]="'Hide password'">
                                <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
                            </button>
                            @if (resetPasswordForm.get('confirmPassword')?.invalid &&
                            resetPasswordForm.get('confirmPassword')?.touched) {
                            <mat-error>{{ getConfirmPasswordErrorMessage() }}</mat-error>
                            }
                            @if (resetPasswordForm.hasError('passwordMismatch') &&
                            resetPasswordForm.get('confirmPassword')?.touched) {
                            <mat-error>Passwords do not match</mat-error>
                            }
                        </mat-form-field>
                    </div>

                    <button mat-raised-button type="submit" class="reset-button"
                        [disabled]="resetPasswordForm.invalid || isLoading()">
                        @if (isLoading()) {
                        <mat-spinner diameter="20"></mat-spinner>
                        Resetting Password...
                        } @else {
                        <mat-icon>check_circle</mat-icon>
                        Reset Password
                        }
                    </button>
                </form>

                <div class="back-link">
                    <a routerLink="/auth/login">
                        <mat-icon>arrow_back</mat-icon>
                        Back to Login
                    </a>
                </div>

                <div class="help-text">
                    <mat-icon>info</mat-icon>
                    <span>The verification code expires in 15 minutes</span>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>