<mat-card>
    <div class="card-header">
        <h2>
            <mat-icon>people</mat-icon>
            Gestion des utilisateurs ({{ users().length }})
        </h2>
    </div>

    <mat-divider></mat-divider>

    <div class="table-container">
        <table mat-table [dataSource]="users()" matSort (matSortChange)="handleSort($event)">

            <!-- ID Column -->
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
                <td mat-cell *matCellDef="let user">
                    #{{ user.id }}
                </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Nom</th>
                <td mat-cell *matCellDef="let user">
                    <strong>{{ user.firstName }} {{ user.lastName }}</strong>
                </td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
                <td mat-cell *matCellDef="let user">
                    {{ user.email }}
                </td>
            </ng-container>

            <!-- Role Column -->
            <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef>Rôle</th>
                <td mat-cell *matCellDef="let user">
                    <mat-form-field class="role-select">
                        <mat-select [value]="user.role" (selectionChange)="changeUserRole(user.id, $event.value)">
                            <mat-option value="CLIENT">Client</mat-option>
                            <mat-option value="ADMIN">Admin</mat-option>
                            <mat-option value="SUPER_ADMIN">Super Admin</mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-container>

            <!-- Provider Column -->
            <ng-container matColumnDef="provider">
                <th mat-header-cell *matHeaderCellDef>Connexion</th>
                <td mat-cell *matCellDef="let user">
                    @if (user.provider === 'GOOGLE') {
                    <mat-chip color="primary">
                        <mat-icon>g_translate</mat-icon>
                        Google
                    </mat-chip>
                    } @else {
                    <mat-chip>
                        <mat-icon>email</mat-icon>
                        Local
                    </mat-chip>
                    }
                </td>
            </ng-container>

            <!-- Enabled Column -->
            <ng-container matColumnDef="isActive">
                <th mat-header-cell *matHeaderCellDef>Statut</th>
                <td mat-cell *matCellDef="let user">
                    <mat-slide-toggle [checked]="user.isActive" (change)="toggleUserStatus(user.id)" color="primary">
                        {{ user.isActive ? 'Actif' : 'Désactivé' }}
                    </mat-slide-toggle>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let user">
                    <button mat-icon-button color="primary" matTooltip="Voir le profil">
                        <mat-icon>visibility</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
        </table>

        <mat-paginator [pageSize]="pageSize()" [pageSizeOptions]="[5, 10, 25, 50]" (page)="handlePageEvent($event)">
        </mat-paginator>
    </div>
</mat-card>