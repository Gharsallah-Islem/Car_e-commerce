<div class="chat-window" *ngIf="conversationId">
    <!-- Premium Header with AI Avatar -->
    <div class="chat-header">
        <div class="chat-info">
            <div class="avatar">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                </svg>
            </div>
            <div class="chat-title">
                <h3>Shopping Assistant</h3>
                <p class="status">Online</p>
            </div>
        </div>
        <div class="chat-actions">
            <!-- Refresh Button -->
            <button class="action-btn refresh-btn" [class.spinning]="refreshing()" (click)="refreshMessages()"
                title="Check for new messages" [disabled]="refreshing()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                </svg>
            </button>
            <!-- Archive Button -->
            <button class="action-btn" (click)="archiveChat()" title="Archive conversation">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Messages Container -->
    <div class="messages-container" #messagesContainer>
        <div class="loading-spinner" *ngIf="loading()">
            <div class="spinner"></div>
            <p>Loading messages...</p>
        </div>

        <div class="messages-list" *ngIf="!loading()">
            <app-message-bubble *ngFor="let message of messages(); trackBy: trackByMessageId" [message]="message"
                [isOwn]="isOwnMessage(message)" [showSenderName]="!isOwnMessage(message)"
                (delete)="onDeleteMessage($event)">
            </app-message-bubble>

            <!-- Typing Indicator -->
            <div class="typing-indicator" *ngIf="aiTyping()">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <div class="no-messages" *ngIf="messages().length === 0 && !aiTyping()">
                <svg width="64" height="64" viewBox="0 0 24 24">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                </svg>
                <p>Start a conversation!</p>
                <span>Ask me about car parts, stock availability, or get help with your order.</span>
            </div>
        </div>
    </div>

    <!-- Input Area -->
    <app-message-input [disabled]="sending()" (sendMessage)="onSendMessage($event)">
    </app-message-input>
</div>

<!-- No Conversation Selected - Premium Welcome State -->
<div class="no-conversation" *ngIf="!conversationId">
    <svg width="80" height="80" viewBox="0 0 24 24">
        <path
            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
    </svg>
    <h2>AI Shopping Assistant</h2>
    <p>I can help you find car parts, check stock availability, compare prices, and even add products to your cart.
        Start a conversation!</p>
    <button class="start-chat-btn" (click)="startNewChat()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
        </svg>
        Start New Chat
    </button>
</div>