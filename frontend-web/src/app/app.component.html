<!-- Global Loading Spinner -->
<div class="loading-overlay" *ngIf="loadingService.isLoading()">
  <mat-spinner diameter="60"></mat-spinner>
</div>

<!-- Header / Navbar - Premium Design -->
@if (showNavbar()) {
<header class="navbar-premium" [class.scrolled]="isScrolled()">
  <div class="navbar-inner">
    <!-- Logo -->
    <a class="logo" routerLink="/">
      <div class="logo-icon">
        <mat-icon>directions_car</mat-icon>
      </div>
      <span class="logo-text">AutoParts</span>
    </a>

    <!-- Navigation Links -->
    <nav class="nav-center">
      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">
        Home
      </a>
      <a routerLink="/products" routerLinkActive="active" class="nav-link">
        Products
      </a>
      <a routerLink="/ai-mechanic" routerLinkActive="active" class="nav-link">
        <mat-icon class="nav-icon-ai">auto_awesome</mat-icon>
        AI Mechanic
      </a>
      <a routerLink="/chat" routerLinkActive="active" class="nav-link">
        Support
      </a>
    </nav>

    <!-- Right Actions -->
    <div class="nav-actions">
      <!-- Search Button -->
      <button class="action-btn search-trigger" (click)="toggleSearch()">
        <mat-icon>search</mat-icon>
      </button>

      <!-- Cart -->
      <a routerLink="/cart" class="action-btn cart-btn">
        <mat-icon>shopping_bag</mat-icon>
        @if (cartItemCount() > 0) {
        <span class="cart-badge">{{ cartItemCount() }}</span>
        }
      </a>

      <!-- User Menu -->
      @if (isLoggedIn()) {
      <button class="user-avatar" [matMenuTriggerFor]="userMenu">
        @if (authService.currentUser()?.profilePicture) {
        <img [src]="authService.currentUser()?.profilePicture" alt="Profile" class="avatar-image">
        } @else {
        <span class="avatar-letter">{{ userName().charAt(0).toUpperCase() }}</span>
        }
      </button>
      <mat-menu #userMenu="matMenu" class="premium-menu">
        <div class="menu-header">
          <span class="menu-user">{{ userName() }}</span>
          <span class="menu-email">{{ authService.currentUser()?.email }}</span>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/profile">
          <mat-icon>person_outline</mat-icon>
          <span>My Profile</span>
        </button>
        <button mat-menu-item routerLink="/orders">
          <mat-icon>receipt_long</mat-icon>
          <span>My Orders</span>
        </button>
        <button mat-menu-item routerLink="/chat">
          <mat-icon>chat_bubble_outline</mat-icon>
          <span>Support</span>
        </button>
        @if (authService.currentUser()?.role === 'ADMIN' || authService.currentUser()?.role === 'SUPER_ADMIN') {
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/admin">
          <mat-icon>admin_panel_settings</mat-icon>
          <span>Admin Panel</span>
        </button>
        }
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="onLogout()" class="logout-item">
          <mat-icon>logout</mat-icon>
          <span>Sign Out</span>
        </button>
      </mat-menu>
      } @else {
      <a routerLink="/auth/login" class="action-btn-text">Sign In</a>
      <a routerLink="/auth/register" class="btn-primary">Get Started</a>
      }
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" (click)="toggleMobileMenu()">
      <mat-icon>{{ mobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
    </button>
  </div>

  <!-- Search Overlay -->
  @if (searchOpen()) {
  <div class="search-overlay" (click)="toggleSearch()">
    <div class="search-modal" (click)="$event.stopPropagation()">
      <mat-icon class="search-icon">search</mat-icon>
      <input type="text" placeholder="Search for parts, brands, categories..." [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch(); toggleSearch()" autofocus>
      <button class="search-close" (click)="toggleSearch()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
  }

  <!-- Mobile Menu -->
  @if (mobileMenuOpen()) {
  <div class="mobile-menu">
    <a routerLink="/" class="mobile-link" (click)="toggleMobileMenu()">Home</a>
    <a routerLink="/products" class="mobile-link" (click)="toggleMobileMenu()">Products</a>
    <a routerLink="/ai-mechanic" class="mobile-link" (click)="toggleMobileMenu()">AI Mechanic</a>
    <a routerLink="/chat" class="mobile-link" (click)="toggleMobileMenu()">Support</a>
    @if (!isLoggedIn()) {
    <div class="mobile-auth">
      <a routerLink="/auth/login" class="mobile-link" (click)="toggleMobileMenu()">Sign In</a>
      <a routerLink="/auth/register" class="mobile-btn-primary" (click)="toggleMobileMenu()">Get Started</a>
    </div>
    }
  </div>
  }
</header>
}

<!-- Main Content -->
<main class="main-content">
  <router-outlet></router-outlet>
</main>

<!-- Footer -->
<footer class="footer">
  <div class="footer-content">
    <div class="footer-section">
      <h3>AutoParts Store</h3>
      <p>Votre partenaire de confiance pour toutes vos pièces automobiles</p>
    </div>

    <div class="footer-section">
      <h4>Navigation</h4>
      <ul>
        <li><a routerLink="/products">Produits</a></li>
        <li><a routerLink="/brands">Marques</a></li>
        <li><a routerLink="/ai-mechanic">IA Mécanique</a></li>
        <li><a routerLink="/about">À propos</a></li>
      </ul>
    </div>

    <div class="footer-section">
      <h4>Service Client</h4>
      <ul>
        <li><a routerLink="/contact">Contact</a></li>
        <li><a routerLink="/faq">FAQ</a></li>
        <li><a routerLink="/shipping">Livraison</a></li>
        <li><a routerLink="/returns">Retours</a></li>
      </ul>
    </div>

    <div class="footer-section">
      <h4>Mon Compte</h4>
      <ul>
        @if (isLoggedIn()) {
        <li><a routerLink="/profile">Mon profil</a></li>
        <li><a routerLink="/orders">Mes commandes</a></li>
        <li><a routerLink="/cart">Mon panier</a></li>
        } @else {
        <li><a routerLink="/auth/login">Connexion</a></li>
        <li><a routerLink="/auth/register">Inscription</a></li>
        }
      </ul>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; 2025 AutoParts Store. Tous droits réservés.</p>
    <div class="footer-links">
      <a routerLink="/privacy">Confidentialité</a>
      <a routerLink="/terms">Conditions d'utilisation</a>
    </div>
  </div>
</footer>